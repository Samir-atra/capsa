<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Metric Wrapper API" href="../../api_documentation/index.html" /><link rel="prev" title="Anomaly Detection (Advanced)" href="6_OOD-Detection.html" />

    <!-- Generated with Sphinx 6.1.3 and Furo 2022.12.07 -->
        <title>Composability (Advanced) - capsa documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?digest=91d0f0d1c444bdcb17a68e833c7a53903343c195" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">capsa  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">capsa  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">üëã Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/installation.html">üíæ Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../risk_metrics/index.html">‚≠êÔ∏è Risk Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/basic_usage.html">üé¨ Basic Usage</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../index.html">üë©‚Äçüè´ Tutorials</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="1_Ensemble-Classification.html">Ensemble Wrapper (Classification)</a></li>
<li class="toctree-l2"><a class="reference internal" href="2_Histogram-Classification.html">Histogram Wrapper (Classification)</a></li>
<li class="toctree-l2"><a class="reference internal" href="3_MVE-Classification.html">MVE Wrapper (Classification)</a></li>
<li class="toctree-l2"><a class="reference internal" href="4_MVE-Regression.html">MVE Wrapper (Regression)</a></li>
<li class="toctree-l2"><a class="reference internal" href="5_High-Dimensional-Depth.html">High Level Introduction to Capsa with a Real World Problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="6_OOD-Detection.html">Anomaly Detection (Advanced)</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Composability (Advanced)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../api_documentation/index.html">‚Äçüíª Metric Wrapper API</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api_documentation/BaseWrapper.html">BaseWrapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_documentation/RiskTensor.html">RiskTensor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_documentation/MVEWrapper.html">MVEWrapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_documentation/VAEWrapper.html">VAEWrapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_documentation/EnsembleWrapper.html">EnsembleWrapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_documentation/DropoutWrapper.html">DropoutWrapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_documentation/HistogramWrapper.html">HistogramWrapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../api_documentation/HistogramVAEWrapper.html">HistogramVAEWrapper</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">üßø Contribute</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<p><img alt="dbef4af13bf147c5a0bcc76457d30453" src="https://i.ibb.co/2P3SLwK/colab.png" /> <a class="reference external" href="https://colab.research.google.com/github/themis-ai/capsa/blob/main/notebooks/7_Composability.ipynb">Run In Google Colab</a></p>
<section id="Composability-(Advanced)">
<h1>Composability (Advanced)<a class="headerlink" href="#Composability-(Advanced)" title="Permalink to this heading">#</a></h1>
<p>In this tutorial we showcase how our method can compose different algorithms together to quantify different risk metrics efficiently. We further show how the framework yields interpretable risk estimation results that can provide a deeper insight into decision boundaries of the NNs.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>!pip install capsa

# download helper functions for this tutorial
!git clone --depth 1 https://github.com/themis-ai/capsa.git
%cd /content/capsa/notebooks/utils/depth

# download and extract dataset
!wget -q http://argo-1.themisai.io/demos/nyu_depth/nyu.h5
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import tensorflow as tf
import config as config
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from utils import get_datasets
ds_train, ds_test = get_datasets(
    id_path = &quot;nyu.h5&quot;
)
</pre></div>
</div>
</div>
<p>By composibility we mean applying multiple wrappers sequentially. This combination results in a single risk aware model. Same as with any other <code class="docutils literal notranslate"><span class="pre">Capsa</span></code> wrapper, user could simply wrap their model with it. Concretely, we can wrap a <code class="docutils literal notranslate"><span class="pre">base_model</span></code> with one of the <code class="docutils literal notranslate"><span class="pre">capsa</span></code>‚Äôs wrappers e.g.¬†the <a class="reference external" href="https://themisai.io/capsa/api_documentation/VAEWrapper.html">VAEWrapper</a> and then apply the <a class="reference external" href="https://themisai.io/capsa/api_documentation/EnsembleWrapper.html">EnsembleWrapper</a> to the resulting
model.</p>
<p>The approach outlined above helps to improve the uncertainty estimate of any of the <code class="docutils literal notranslate"><span class="pre">Capsa</span></code> wrappers. This significantly increases the computational cost, however it might worth it depending on the goal that a user wants to achieve.</p>
<p>Let‚Äôs train our model. We‚Äôll demonstrate the approach described above by ensembling the <code class="docutils literal notranslate"><span class="pre">DropoutWrapper</span></code>. We use the same ‚Äúbase model‚Äù as in the previous tutorials (part 5, part 6).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from models import unet
from capsa import DropoutWrapper, EnsembleWrapper

base_model = unet(drop_prob=0.1)
# don&#39;t add dropout in the wrapper because our model already contains dropout layers
model = EnsembleWrapper(base_model, num_members=3, metric_wrapper=DropoutWrapper, kwargs={&#39;p&#39;: 0.0})
model_name = &quot;compatibility_dropout&quot;

model.compile(
    optimizer=tf.keras.optimizers.Adam(learning_rate=config.LR),
    loss=&quot;mse&quot;,
)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>history = model.fit(
    ds_train,
    epochs=config.EP,
    validation_data=ds_test,
)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Epoch 1/20
256/256 [==============================] - 56s 192ms/step - dropout_0_compiled_loss: 0.1748 - dropout_0_wrapper_loss: 0.0821 - dropout_1_compiled_loss: 0.0831 - dropout_1_wrapper_loss: 0.0572 - dropout_2_compiled_loss: 0.1017 - dropout_2_wrapper_loss: 0.0647 - val_dropout_0_compiled_loss: 0.0810 - val_dropout_0_wrapper_loss: 0.0382 - val_dropout_1_compiled_loss: 0.0567 - val_dropout_1_wrapper_loss: 0.0382 - val_dropout_2_compiled_loss: 0.0643 - val_dropout_2_wrapper_loss: 0.0455
Epoch 2/20
256/256 [==============================] - 50s 194ms/step - dropout_0_compiled_loss: 0.0689 - dropout_0_wrapper_loss: 0.0389 - dropout_1_compiled_loss: 0.0515 - dropout_1_wrapper_loss: 0.0369 - dropout_2_compiled_loss: 0.0583 - dropout_2_wrapper_loss: 0.0422 - val_dropout_0_compiled_loss: 0.0598 - val_dropout_0_wrapper_loss: 0.0329 - val_dropout_1_compiled_loss: 0.0468 - val_dropout_1_wrapper_loss: 0.0318 - val_dropout_2_compiled_loss: 0.0532 - val_dropout_2_wrapper_loss: 0.0377
Epoch 3/20
256/256 [==============================] - 50s 196ms/step - dropout_0_compiled_loss: 0.0543 - dropout_0_wrapper_loss: 0.0282 - dropout_1_compiled_loss: 0.0429 - dropout_1_wrapper_loss: 0.0237 - dropout_2_compiled_loss: 0.0497 - dropout_2_wrapper_loss: 0.0322 - val_dropout_0_compiled_loss: 0.0492 - val_dropout_0_wrapper_loss: 0.0198 - val_dropout_1_compiled_loss: 0.0390 - val_dropout_1_wrapper_loss: 0.0181 - val_dropout_2_compiled_loss: 0.0462 - val_dropout_2_wrapper_loss: 0.0256
Epoch 4/20
256/256 [==============================] - 50s 196ms/step - dropout_0_compiled_loss: 0.0452 - dropout_0_wrapper_loss: 0.0175 - dropout_1_compiled_loss: 0.0358 - dropout_1_wrapper_loss: 0.0139 - dropout_2_compiled_loss: 0.0430 - dropout_2_wrapper_loss: 0.0205 - val_dropout_0_compiled_loss: 0.0413 - val_dropout_0_wrapper_loss: 0.0149 - val_dropout_1_compiled_loss: 0.0327 - val_dropout_1_wrapper_loss: 0.0125 - val_dropout_2_compiled_loss: 0.0397 - val_dropout_2_wrapper_loss: 0.0160
Epoch 5/20
256/256 [==============================] - 50s 196ms/step - dropout_0_compiled_loss: 0.0382 - dropout_0_wrapper_loss: 0.0108 - dropout_1_compiled_loss: 0.0303 - dropout_1_wrapper_loss: 0.0086 - dropout_2_compiled_loss: 0.0370 - dropout_2_wrapper_loss: 0.0124 - val_dropout_0_compiled_loss: 0.0352 - val_dropout_0_wrapper_loss: 0.0089 - val_dropout_1_compiled_loss: 0.0279 - val_dropout_1_wrapper_loss: 0.0063 - val_dropout_2_compiled_loss: 0.0342 - val_dropout_2_wrapper_loss: 0.0093
Epoch 6/20
256/256 [==============================] - 50s 197ms/step - dropout_0_compiled_loss: 0.0328 - dropout_0_wrapper_loss: 0.0075 - dropout_1_compiled_loss: 0.0260 - dropout_1_wrapper_loss: 0.0056 - dropout_2_compiled_loss: 0.0320 - dropout_2_wrapper_loss: 0.0077 - val_dropout_0_compiled_loss: 0.0306 - val_dropout_0_wrapper_loss: 0.0076 - val_dropout_1_compiled_loss: 0.0242 - val_dropout_1_wrapper_loss: 0.0049 - val_dropout_2_compiled_loss: 0.0298 - val_dropout_2_wrapper_loss: 0.0073
Epoch 7/20
256/256 [==============================] - 50s 197ms/step - dropout_0_compiled_loss: 0.0287 - dropout_0_wrapper_loss: 0.0055 - dropout_1_compiled_loss: 0.0227 - dropout_1_wrapper_loss: 0.0043 - dropout_2_compiled_loss: 0.0281 - dropout_2_wrapper_loss: 0.0058 - val_dropout_0_compiled_loss: 0.0270 - val_dropout_0_wrapper_loss: 0.0044 - val_dropout_1_compiled_loss: 0.0213 - val_dropout_1_wrapper_loss: 0.0033 - val_dropout_2_compiled_loss: 0.0264 - val_dropout_2_wrapper_loss: 0.0053
Epoch 8/20
256/256 [==============================] - 50s 197ms/step - dropout_0_compiled_loss: 0.0255 - dropout_0_wrapper_loss: 0.0043 - dropout_1_compiled_loss: 0.0202 - dropout_1_wrapper_loss: 0.0032 - dropout_2_compiled_loss: 0.0250 - dropout_2_wrapper_loss: 0.0045 - val_dropout_0_compiled_loss: 0.0241 - val_dropout_0_wrapper_loss: 0.0032 - val_dropout_1_compiled_loss: 0.0191 - val_dropout_1_wrapper_loss: 0.0029 - val_dropout_2_compiled_loss: 0.0237 - val_dropout_2_wrapper_loss: 0.0035
Epoch 9/20
256/256 [==============================] - 50s 197ms/step - dropout_0_compiled_loss: 0.0230 - dropout_0_wrapper_loss: 0.0037 - dropout_1_compiled_loss: 0.0182 - dropout_1_wrapper_loss: 0.0029 - dropout_2_compiled_loss: 0.0225 - dropout_2_wrapper_loss: 0.0037 - val_dropout_0_compiled_loss: 0.0219 - val_dropout_0_wrapper_loss: 0.0035 - val_dropout_1_compiled_loss: 0.0173 - val_dropout_1_wrapper_loss: 0.0031 - val_dropout_2_compiled_loss: 0.0214 - val_dropout_2_wrapper_loss: 0.0037
Epoch 10/20
256/256 [==============================] - 50s 197ms/step - dropout_0_compiled_loss: 0.0209 - dropout_0_wrapper_loss: 0.0030 - dropout_1_compiled_loss: 0.0165 - dropout_1_wrapper_loss: 0.0026 - dropout_2_compiled_loss: 0.0205 - dropout_2_wrapper_loss: 0.0031 - val_dropout_0_compiled_loss: 0.0200 - val_dropout_0_wrapper_loss: 0.0034 - val_dropout_1_compiled_loss: 0.0158 - val_dropout_1_wrapper_loss: 0.0031 - val_dropout_2_compiled_loss: 0.0196 - val_dropout_2_wrapper_loss: 0.0038
Epoch 11/20
256/256 [==============================] - 50s 197ms/step - dropout_0_compiled_loss: 0.0192 - dropout_0_wrapper_loss: 0.0027 - dropout_1_compiled_loss: 0.0152 - dropout_1_wrapper_loss: 0.0023 - dropout_2_compiled_loss: 0.0188 - dropout_2_wrapper_loss: 0.0027 - val_dropout_0_compiled_loss: 0.0184 - val_dropout_0_wrapper_loss: 0.0032 - val_dropout_1_compiled_loss: 0.0146 - val_dropout_1_wrapper_loss: 0.0026 - val_dropout_2_compiled_loss: 0.0181 - val_dropout_2_wrapper_loss: 0.0034
Epoch 12/20
256/256 [==============================] - 50s 197ms/step - dropout_0_compiled_loss: 0.0177 - dropout_0_wrapper_loss: 0.0024 - dropout_1_compiled_loss: 0.0141 - dropout_1_wrapper_loss: 0.0020 - dropout_2_compiled_loss: 0.0174 - dropout_2_wrapper_loss: 0.0026 - val_dropout_0_compiled_loss: 0.0171 - val_dropout_0_wrapper_loss: 0.0023 - val_dropout_1_compiled_loss: 0.0135 - val_dropout_1_wrapper_loss: 0.0020 - val_dropout_2_compiled_loss: 0.0168 - val_dropout_2_wrapper_loss: 0.0024
Epoch 13/20
256/256 [==============================] - 50s 197ms/step - dropout_0_compiled_loss: 0.0165 - dropout_0_wrapper_loss: 0.0023 - dropout_1_compiled_loss: 0.0131 - dropout_1_wrapper_loss: 0.0019 - dropout_2_compiled_loss: 0.0162 - dropout_2_wrapper_loss: 0.0023 - val_dropout_0_compiled_loss: 0.0159 - val_dropout_0_wrapper_loss: 0.0022 - val_dropout_1_compiled_loss: 0.0126 - val_dropout_1_wrapper_loss: 0.0020 - val_dropout_2_compiled_loss: 0.0157 - val_dropout_2_wrapper_loss: 0.0024
Epoch 14/20
256/256 [==============================] - 50s 197ms/step - dropout_0_compiled_loss: 0.0154 - dropout_0_wrapper_loss: 0.0022 - dropout_1_compiled_loss: 0.0122 - dropout_1_wrapper_loss: 0.0017 - dropout_2_compiled_loss: 0.0152 - dropout_2_wrapper_loss: 0.0021 - val_dropout_0_compiled_loss: 0.0150 - val_dropout_0_wrapper_loss: 0.0020 - val_dropout_1_compiled_loss: 0.0119 - val_dropout_1_wrapper_loss: 0.0016 - val_dropout_2_compiled_loss: 0.0147 - val_dropout_2_wrapper_loss: 0.0019
Epoch 15/20
256/256 [==============================] - 50s 197ms/step - dropout_0_compiled_loss: 0.0145 - dropout_0_wrapper_loss: 0.0020 - dropout_1_compiled_loss: 0.0115 - dropout_1_wrapper_loss: 0.0018 - dropout_2_compiled_loss: 0.0143 - dropout_2_wrapper_loss: 0.0020 - val_dropout_0_compiled_loss: 0.0141 - val_dropout_0_wrapper_loss: 0.0021 - val_dropout_1_compiled_loss: 0.0112 - val_dropout_1_wrapper_loss: 0.0021 - val_dropout_2_compiled_loss: 0.0138 - val_dropout_2_wrapper_loss: 0.0022
Epoch 16/20
256/256 [==============================] - 50s 197ms/step - dropout_0_compiled_loss: 0.0137 - dropout_0_wrapper_loss: 0.0019 - dropout_1_compiled_loss: 0.0109 - dropout_1_wrapper_loss: 0.0017 - dropout_2_compiled_loss: 0.0135 - dropout_2_wrapper_loss: 0.0019 - val_dropout_0_compiled_loss: 0.0133 - val_dropout_0_wrapper_loss: 0.0019 - val_dropout_1_compiled_loss: 0.0106 - val_dropout_1_wrapper_loss: 0.0023 - val_dropout_2_compiled_loss: 0.0131 - val_dropout_2_wrapper_loss: 0.0018
Epoch 17/20
256/256 [==============================] - 50s 197ms/step - dropout_0_compiled_loss: 0.0130 - dropout_0_wrapper_loss: 0.0018 - dropout_1_compiled_loss: 0.0103 - dropout_1_wrapper_loss: 0.0015 - dropout_2_compiled_loss: 0.0128 - dropout_2_wrapper_loss: 0.0018 - val_dropout_0_compiled_loss: 0.0126 - val_dropout_0_wrapper_loss: 0.0017 - val_dropout_1_compiled_loss: 0.0101 - val_dropout_1_wrapper_loss: 0.0014 - val_dropout_2_compiled_loss: 0.0124 - val_dropout_2_wrapper_loss: 0.0016
Epoch 18/20
256/256 [==============================] - 50s 197ms/step - dropout_0_compiled_loss: 0.0123 - dropout_0_wrapper_loss: 0.0018 - dropout_1_compiled_loss: 0.0098 - dropout_1_wrapper_loss: 0.0016 - dropout_2_compiled_loss: 0.0121 - dropout_2_wrapper_loss: 0.0016 - val_dropout_0_compiled_loss: 0.0120 - val_dropout_0_wrapper_loss: 0.0019 - val_dropout_1_compiled_loss: 0.0096 - val_dropout_1_wrapper_loss: 0.0021 - val_dropout_2_compiled_loss: 0.0118 - val_dropout_2_wrapper_loss: 0.0023
Epoch 19/20
256/256 [==============================] - 50s 197ms/step - dropout_0_compiled_loss: 0.0118 - dropout_0_wrapper_loss: 0.0016 - dropout_1_compiled_loss: 0.0094 - dropout_1_wrapper_loss: 0.0014 - dropout_2_compiled_loss: 0.0116 - dropout_2_wrapper_loss: 0.0015 - val_dropout_0_compiled_loss: 0.0115 - val_dropout_0_wrapper_loss: 0.0014 - val_dropout_1_compiled_loss: 0.0091 - val_dropout_1_wrapper_loss: 0.0013 - val_dropout_2_compiled_loss: 0.0113 - val_dropout_2_wrapper_loss: 0.0014
Epoch 20/20
256/256 [==============================] - 50s 197ms/step - dropout_0_compiled_loss: 0.0112 - dropout_0_wrapper_loss: 0.0015 - dropout_1_compiled_loss: 0.0090 - dropout_1_wrapper_loss: 0.0013 - dropout_2_compiled_loss: 0.0111 - dropout_2_wrapper_loss: 0.0016 - val_dropout_0_compiled_loss: 0.0110 - val_dropout_0_wrapper_loss: 0.0015 - val_dropout_1_compiled_loss: 0.0088 - val_dropout_1_wrapper_loss: 0.0013 - val_dropout_2_compiled_loss: 0.0108 - val_dropout_2_wrapper_loss: 0.0016
</pre></div></div>
</div>
<p>Perfect! We‚Äôve traind our risk-aware model, now let‚Äôs look at the loss curves.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from utils import plot_loss
plot_loss(history, compiled_only=True)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_7_Composability_11_0.png" src="../../_images/tutorials_notebooks_7_Composability_11_0.png" />
</div>
</div>
<p>Let‚Äôs visualize model predictions. <a class="reference external" href="https://themisai.io/capsa/api_documentation/DropoutWrapper.html">DropoutWrapper</a> is an epistemic wrapper and indeed we see that increased epistemic uncertainty roughly corresponds to the semantically and visually challenging pixels where the model is making errors.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from utils import vis_depth_map
vis_depth_map(model, ds_test)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_7_Composability_13_0.png" src="../../_images/tutorials_notebooks_7_Composability_13_0.png" />
</div>
</div>
<p>Let‚Äôs look at the calibration plot that the model produces to quantitatively assess the quality of the risk estimate.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from capsa.utils import gen_calibration_plot
gen_calibration_plot(model, ds_test)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_notebooks_7_Composability_15_0.png" src="../../_images/tutorials_notebooks_7_Composability_15_0.png" />
</div>
</div>
<section id="To-sum-up-üèÜ">
<h2>To sum up üèÜ<a class="headerlink" href="#To-sum-up-üèÜ" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>We showcased how our method can compose different algorithms together to quantify different risk metrics.</p></li>
<li><p>We further showed how the framework yields interpretable risk estimation results that can provide a deeper insight into decision boundaries of the NNs.</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../../api_documentation/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Metric Wrapper API</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="6_OOD-Detection.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Anomaly Detection (Advanced)</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, Themis AI Inc
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Composability (Advanced)</a><ul>
<li><a class="reference internal" href="#To-sum-up-üèÜ">To sum up üèÜ</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/scripts/furo.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>